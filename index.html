<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Executor JSON Web com CSS Estruturado</title>
</head>
<body>
  <div id="app"></div>

  <script>
    // Função para aplicar eventos ao elemento
    function aplicarEventos(el, eventos) {
      for (let evento in eventos) {
        el.addEventListener(evento, function (e) {
          try {
            eval(eventos[evento]);
          } catch (err) {
            console.error("Erro no evento:", err);
          }
        });
      }
    }

    // Função para criar o elemento HTML baseado no JSON
    function criarElemento(e) {
      let el = document.createElement(e.tag || "div");

      // Adiciona atributos ao elemento
      if (e.attrs) {
        for (let k in e.attrs) {
          if (k === "innerHTML") {
            el.innerHTML = e.attrs[k];
          } else {
            el.setAttribute(k, e.attrs[k]);
          }
        }
      }

      // Adiciona texto ao elemento
      if (e.text) el.textContent = e.text;

      // Aplica estilo se presente
      if (e.style) {
        for (let prop in e.style) {
          el.style[prop] = e.style[prop];
        }
      }

      // Aplica eventos se presentes
      if (e.events) {
        aplicarEventos(el, e.events);
      }

      // Adiciona filhos se presentes
      if (e.children) {
        e.children.forEach(child => {
          el.appendChild(criarElemento(child));
        });
      }

      return el;
    }

    // Função para aplicar o CSS baseado em JSON
    function aplicarCssJson(cssJson) {
      const styleTag = document.createElement("style");
      let cssText = "";

      // Converte o JSON de CSS para formato CSS
      for (let seletor in cssJson) {
        cssText += seletor + " {";
        const props = cssJson[seletor];
        for (let prop in props) {
          const cssProp = prop.replace(/([A-Z])/g, "-$1").toLowerCase(); // camelCase -> kebab-case
          cssText += `${cssProp}:${props[prop]};`;
        }
        cssText += "} ";
      }

      styleTag.textContent = cssText;
      document.head.appendChild(styleTag);
    }

    // Função para carregar o JSON e executar o HTML, CSS e JS
    function carregarJson() {
      fetch("https://dev-victor-yt.github.io/Executor-Web.Json/index.json")
        .then(res => res.json())
        .then(json => {
          if (json.css) aplicarCssJson(json.css); // Aplica o CSS
          if (json.html) {
            const root = criarElemento(json.html); // Cria os elementos HTML
            document.getElementById("app").appendChild(root);
          }
          if (json.js) {
            // Executa o código JavaScript se presente
            try {
              eval(json.js);
            } catch (err) {
              console.error("Erro ao executar o JavaScript:", err);
            }
          }
        })
        .catch(err => {
          document.getElementById("app").textContent = "Erro ao carregar JSON: " + err;
        });
    }

    // Carrega o JSON ao carregar a página
    carregarJson();
  </script>
</body>
</html>